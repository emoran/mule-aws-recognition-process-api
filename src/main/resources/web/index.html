<html>
	<head>
		<link rel="stylesheet" type="text/css" href="assets/styles/salesforce-lightning-design-system.min.css">
	   
	</head>     
	<body>
		<div class="slds-scope">
	   <article class="slds-card">
		  <div class="slds-card__header slds-grid">
			<header class="slds-media slds-media_center slds-has-flexi-truncate">
			  <div class="slds-media__figure">
				<img src="mule.png" width="20px"/>
			  </div>
			  <div class="slds-media__body">
				<h2 class="slds-card__header-title">
				  <span>Images</span>
				</h2>
			  </div>			     
			</header>
		  </div>
		  <div class="results slds-card__body slds-card__body_inner">
			
				
		  </div>
		  
		</article>
		</div>
	</body>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
	
	<script>
	
		$(document).ready(function(){ 
			console.log(' Mulesoft Hackathon 2020 ');
			getImagesWithLabels();
		});

		function getImagesWithLabels(){
			console.log('getting images');
			$.ajax({
				type                         : "GET",
				url                          : "/api/sfdc/images",
				
				contentType                  : "application/json",
				headers                      : { 
					'Accept'                 : 'application/json',
					'Content-Type'           : 'application/json' 
				},
				dataType                     : "json",
				success                      : function (data) {
					
					console.log("Data retrieved: ", JSON.stringify(data));
					
					var sections = '';

					$.each(data, function( index, value ) {
						
					

						$.ajax({
							type                         : "GET",
							url                          : "/api/sfdc/contentVersion?id="+value.Image_Labels__r[0].Content_Version__c+"",							
							contentType                  : "application/json",
							headers                      : { 
								'Accept'                 : 'application/json',
								'Content-Type'           : 'application/json' 
							},
							dataType                     : "json",
							success                      : function (data) {
								console.log('success content version'+data);

								sections +='<div class="demo-only" style="width:30rem">';
									sections +='	<article class="slds-tile">';
									sections +='	<h3 class="slds-tile__title slds-truncate" title="Salesforce UX">';
									sections +='		<a href="javascript:void(0);">'+value.Name+'</a>';
									sections +='	</h3>';
									sections += '	<img src="data:image/jpeg;base64,'+data.image+'"/>';
									sections +='	<div class="slds-tile__detail">';
									sections +='		<dl class="slds-list_horizontal slds-wrap">';
										$.each(value.Image_Labels__r, function( indexNested, valueNested ) {
											sections +='		<dt class="slds-item_label slds-text-color_weak slds-truncate" title="First Label">Label:</dt>';
											sections +='		<dd class="slds-item_detail slds-truncate" title="Description for first label">'+valueNested.Label__c+'</dd>';
			
											sections +='		<dt class="slds-item_label slds-text-color_weak slds-truncate" title="Second Label">Accuracy:</dt>';
											sections +='		<dd class="slds-item_detail slds-truncate" title="Description for second label">'+valueNested.Accuracy__c+'</dd>';
										});							
									sections +='		</dl>';
									sections +='	</div>';
									sections +='	</article>';
									sections +='</div>';
									sections +='<br/>';
									$(".results").html(sections);
						
							},
							error                        : function (e) {						
							  console.log("ERROR         : ", e);
							}
						});

						
	
					});
					
					

				
					
					

				},
				error                        : function (e) {

				  console.log("ERROR         : ", e);
				}
			});
		}
	</script>
</html>
			